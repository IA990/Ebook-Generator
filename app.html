
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ebook Generator</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Noto Sans for multilingual support -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet" />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <!-- PDF-lib library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-gradient-to-r from-indigo-600 to-blue-600 text-white py-6">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <h1 class="text-3xl font-bold">Ebook Generator</h1>
                <nav>
                    <button id="langToggle" class="bg-indigo-800 px-3 py-1 rounded hover:bg-indigo-700 transition">
                        FR
                    </button>
                    <button id="themeToggle" class="ml-4 bg-indigo-800 px-3 py-1 rounded hover:bg-indigo-700 transition">
                        Mode Sombre
                    </button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8 flex-grow">
            <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <form id="ebookForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="title" class="block text-sm font-medium text-gray-700 mb-2" data-lang="titleLabel">Ebook Title</label>
                        <input type="text" id="title" required
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                    </div>
                    <div>
                        <label for="author" class="block text-sm font-medium text-gray-700 mb-2" data-lang="authorLabel">Author</label>
                        <input type="text" id="author" required
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                    </div>
                    <div class="md:col-span-2">
                        <label for="aiPrompt" class="block text-sm font-medium text-gray-700 mb-2">AI Prompt</label>
                        <textarea id="aiPrompt" rows="3" placeholder="Enter a prompt to generate ebook content"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                        <button type="button" id="generateAIContent" class="mt-2 px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
                            Generate Content with AI
                        </button>
                        <p id="aiStatus" class="mt-2 text-sm text-gray-600"></p>
                    </div>
                </div>

                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2" data-lang="descriptionLabel">Description</label>
                        <textarea id="description" rows="4"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" data-lang="chaptersLabel">Chapters</label>
                        <div id="chapters" class="space-y-4">
                            <div class="chapter-entry flex items-start space-x-4">
                                <div class="flex-grow">
                                    <input type="text" placeholder="Chapter Title" class="w-full px-4 py-2 border rounded-lg mb-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                                    <textarea placeholder="Chapter Content" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                                </div>
                                <button type="button" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <button type="button" id="addChapter" class="mt-4 px-4 py-2 text-sm text-indigo-600 border border-indigo-600 rounded-lg hover:bg-indigo-50">
                            <i class="fas fa-plus mr-2"></i><span data-lang="addChapterBtn">Add Chapter</span>
                        </button>
                    </div>

                    <div class="border-t pt-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4" data-lang="settingsTitle">Ebook Settings</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label for="format" class="block text-sm font-medium text-gray-700 mb-2" data-lang="formatLabel">Format</label>
                                <select id="format" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="6x9">6" x 9" (KDP Standard)</option>
                                    <option value="5x8">5" x 8"</option>
                                    <option value="7x10">7" x 10"</option>
                                </select>
                            </div>
                            <div>
                                <label for="font" class="block text-sm font-medium text-gray-700 mb-2" data-lang="fontLabel">Font</label>
                                <select id="font" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="times">Times New Roman</option>
                                    <option value="arial">Arial</option>
                                    <option value="georgia">Georgia</option>
                                </select>
                            </div>
                            <div>
                                <label for="fontSize" class="block text-sm font-medium text-gray-700 mb-2" data-lang="fontSizeLabel">Font Size</label>
                                <select id="fontSize" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="11">11pt</option>
                                    <option value="12">12pt</option>
                                    <option value="14">14pt</option>
                                </select>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                            <div>
                                <label for="margin" class="block text-sm font-medium text-gray-700 mb-2">Page Margin (pt)</label>
                                <input type="number" id="margin" min="10" max="100" value="50" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                            </div>
                            <div>
                                <label for="lineHeight" class="block text-sm font-medium text-gray-700 mb-2">Line Height (pt)</label>
                                <input type="number" id="lineHeight" min="10" max="40" value="18" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                            </div>
                            <div>
                                <label for="textAlign" class="block text-sm font-medium text-gray-700 mb-2">Text Alignment</label>
                                <select id="textAlign" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    <option value="left">Left</option>
                                    <option value="center">Center</option>
                                    <option value="right">Right</option>
                                    <option value="justify">Justify</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="border-t pt-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Illustrations</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="illustrationPrompt" class="block text-sm font-medium text-gray-700 mb-2">Illustration Prompt</label>
                                <input type="text" id="illustrationPrompt" placeholder="Enter prompt for illustration" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                            </div>
                            <div class="flex items-end">
                                <button type="button" id="generateIllustration" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
                                    Generate Illustration
                                </button>
                            </div>
                        </div>
                        <div id="illustrationPreview" class="mt-4"></div>
                    </div>

                    <div class="flex justify-center pt-6">
                        <button type="submit" id="generatePDF" class="px-8 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            <i class="fas fa-file-pdf mr-2"></i><span data-lang="generateBtn">Generate PDF</span>
                        </button>
                    </div>
                </form>
            </div>
        </main>

        <footer class="bg-gray-800 text-white py-6 mt-12 text-center">
            <div class="container mx-auto px-4">
                <p>© 2024 Ebook Generator. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Language translations
            const translations = {
                en: {
                    titleLabel: "Ebook Title",
                    authorLabel: "Author",
                    descriptionLabel: "Description",
                    chaptersLabel: "Chapters",
                    addChapterBtn: "Add Chapter",
                    settingsTitle: "Ebook Settings",
                    formatLabel: "Format",
                    fontLabel: "Font",
                    fontSizeLabel: "Font Size",
                    generateBtn: "Generate PDF",
                    chapterTitlePlaceholder: "Chapter Title",
                    chapterContentPlaceholder: "Chapter Content",
                    langToggleText: "FR",
                    themeToggleText: "Dark Mode"
                },
                fr: {
                    titleLabel: "Titre de l'Ebook",
                    authorLabel: "Auteur",
                    descriptionLabel: "Description",
                    chaptersLabel: "Chapitres",
                    addChapterBtn: "Ajouter un chapitre",
                    settingsTitle: "Paramètres de l'Ebook",
                    formatLabel: "Format",
                    fontLabel: "Police",
                    fontSizeLabel: "Taille de police",
                    generateBtn: "Générer le PDF",
                    chapterTitlePlaceholder: "Titre du chapitre",
                    chapterContentPlaceholder: "Contenu du chapitre",
                    langToggleText: "EN",
                    themeToggleText: "Mode Sombre"
                }
            };

            let currentLang = 'fr';
            let darkMode = false;

            const elementsToTranslate = document.querySelectorAll('[data-lang]');
            const langToggleBtn = document.getElementById('langToggle');
            const themeToggleBtn = document.getElementById('themeToggle');

            function translatePage(lang) {
                elementsToTranslate.forEach(el => {
                    const key = el.getAttribute('data-lang');
                    if (translations[lang] && translations[lang][key]) {
                        if (el.tagName.toLowerCase() === 'input' || el.tagName.toLowerCase() === 'textarea') {
                            el.placeholder = translations[lang][key];
                        } else {
                            el.textContent = translations[lang][key];
                        }
                    }
                });

                // Update placeholders for chapter inputs
                document.querySelectorAll('#chapters .chapter-entry').forEach(chapter => {
                    const inputs = chapter.querySelectorAll('input, textarea');
                    if (inputs.length >= 2) {
                        inputs[0].placeholder = translations[lang].chapterTitlePlaceholder;
                        inputs[1].placeholder = translations[lang].chapterContentPlaceholder;
                    }
                });

                // Update toggle buttons text
                langToggleBtn.textContent = translations[lang].langToggleText;
                themeToggleBtn.textContent = translations[lang].themeToggleText;
            }

            langToggleBtn.addEventListener('click', () => {
                currentLang = currentLang === 'en' ? 'fr' : 'en';
                translatePage(currentLang);
            });

            themeToggleBtn.addEventListener('click', () => {
                darkMode = !darkMode;
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                    document.body.classList.add('bg-gray-900', 'text-gray-100');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.body.classList.remove('bg-gray-900', 'text-gray-100');
                }
            });

            translatePage(currentLang);

            // Add Chapter Button
            document.getElementById('addChapter').addEventListener('click', function() {
                const chaptersDiv = document.getElementById('chapters');
                const newChapter = document.createElement('div');
                newChapter.className = 'chapter-entry flex items-start space-x-4';
                newChapter.innerHTML = `
                    <div class="flex-grow">
                        <input type="text" placeholder="${translations[currentLang].chapterTitlePlaceholder}" 
                            class="w-full px-4 py-2 border rounded-lg mb-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        <textarea placeholder="${translations[currentLang].chapterContentPlaceholder}" rows="4"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"></textarea>
                    </div>
                    <button type="button" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                chaptersDiv.appendChild(newChapter);

                // Add delete functionality to new chapter
                const deleteButton = newChapter.querySelector('button');
                deleteButton.addEventListener('click', function() {
                    newChapter.remove();
                });
            });

            // Add delete functionality to initial chapter
            const deleteButtons = document.querySelectorAll('.chapter-entry button');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.chapter-entry').remove();
                });
            });

            // Form Submit Handler
            document.getElementById('ebookForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                try {
                    const { PDFDocument, StandardFonts, rgb } = PDFLib;
                    const pdfDoc = await PDFDocument.create();

                    // Get selected format for page size
                    const format = document.getElementById('format').value;
                    let pageWidth = 595.276; // default A4 width in points
                    let pageHeight = 841.890; // default A4 height in points

                    if (format === '6x9') {
                        pageWidth = 432; // 6 inches * 72 points
                        pageHeight = 648; // 9 inches * 72 points
                    } else if (format === '5x8') {
                        pageWidth = 360; // 5 inches * 72 points
                        pageHeight = 576; // 8 inches * 72 points
                    } else if (format === '7x10') {
                        pageWidth = 504; // 7 inches * 72 points
                        pageHeight = 720; // 10 inches * 72 points
                    }

                    // Page margins and line height options
                    const margin = 50;
                    const lineHeight = fontSize + 6;

                    // Add a page
                    let page = pdfDoc.addPage([pageWidth, pageHeight]);
                    const { width, height } = page.getSize();

                    // Get form values
                    const title = document.getElementById('title').value;
                    const author = document.getElementById('author').value;
                    const description = document.getElementById('description').value;
                    const fontChoice = document.getElementById('font').value;
                    const fontSize = parseInt(document.getElementById('fontSize').value);

                    // Embed font
                    let font;
                    if (fontChoice === 'times') {
                        font = await pdfDoc.embedFont(StandardFonts.TimesRoman);
                    } else if (fontChoice === 'arial') {
                        font = await pdfDoc.embedFont(StandardFonts.Helvetica);
                    } else if (fontChoice === 'georgia') {
                        font = await pdfDoc.embedFont(StandardFonts.Courier);
                    } else {
                        font = await pdfDoc.embedFont(StandardFonts.TimesRoman);
                    }

                    // Draw title
                    page.drawText(title, {
                        x: margin,
                        y: height - margin,
                        size: fontSize + 10,
                        font: font,
                        color: rgb(0, 0, 0),
                    });

                    // Draw author
                    page.drawText(`${currentLang === 'fr' ? 'Par' : 'By'} ${author}`, {
                        x: margin,
                        y: height - margin - lineHeight,
                        size: fontSize,
                        font: font,
                        color: rgb(0, 0, 0),
                    });

                    // Draw description with word wrap
                    const maxWidth = width - 2 * margin;
                    let yPosition = height - margin - 2 * lineHeight;

                    function drawWrappedText(text, x, y, maxWidth, lineHeight) {
                        const words = text.split(' ');
                        let line = '';
                        let yPos = y;

                        for (let n = 0; n < words.length; n++) {
                            const testLine = line + words[n] + ' ';
                            const testLineWidth = font.widthOfTextAtSize(testLine, fontSize);
                            if (testLineWidth > maxWidth && n > 0) {
                                page.drawText(line, { x, y: yPos, size: fontSize, font, color: rgb(0, 0, 0) });
                                line = words[n] + ' ';
                                yPos -= lineHeight;
                                if (yPos < margin) {
                                    page = pdfDoc.addPage([pageWidth, pageHeight]);
                                    yPos = height - margin;
                                }
                            } else {
                                line = testLine;
                            }
                        }
                        page.drawText(line, { x, y: yPos, size: fontSize, font, color: rgb(0, 0, 0) });
                        return yPos - lineHeight;
                    }

                    yPosition = drawWrappedText(description, margin, yPosition, maxWidth, lineHeight);

                    // Draw chapters
                    const chapters = document.querySelectorAll('#chapters .chapter-entry');
                    for (const chapter of chapters) {
                        const chapterTitle = chapter.querySelector('input').value;
                        const chapterContent = chapter.querySelector('textarea').value;

                        if (yPosition < margin + lineHeight * 4) {
                            page = pdfDoc.addPage([pageWidth, pageHeight]);
                            yPosition = height - margin;
                        }

                        // Draw chapter title
                        page.drawText(chapterTitle, {
                            x: margin,
                            y: yPosition,
                            size: fontSize + 4,
                            font: font,
                            color: rgb(0, 0, 0),
                        });
                        yPosition -= lineHeight + 4;

                        // Draw chapter content with word wrap
                        yPosition = drawWrappedText(chapterContent, margin + 10, yPosition, maxWidth - 10, lineHeight);
                        yPosition -= lineHeight;
                    }

                    // Save the PDF
                    const pdfBytes = await pdfDoc.save();

                    // Download the PDF
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `${title.replace(/\s+/g, '_')}.pdf`;
                    link.click();
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    alert(currentLang === 'fr' ? 'Une erreur est survenue lors de la génération du PDF. Veuillez réessayer.' : 'An error occurred while generating the PDF. Please try again.');
                }
            });
        });

        // AI Content Generation Button Handler
        document.getElementById('generateAIContent').addEventListener('click', async () => {
            const prompt = document.getElementById('aiPrompt').value.trim();
            const aiStatus = document.getElementById('aiStatus');
            if (!prompt) {
                aiStatus.textContent = currentLang === 'fr' ? 'Veuillez saisir un prompt.' : 'Please enter a prompt.';
                return;
            }
            aiStatus.textContent = currentLang === 'fr' ? 'Génération en cours...' : 'Generating...';

            try {
                const response = await fetch('http://localhost:3000/api/generate-text', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt }),
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                if (data.text) {
                    // Append generated content as a new chapter
                    const chaptersDiv = document.getElementById('chapters');
                    const newChapter = document.createElement('div');
                    newChapter.className = 'chapter-entry flex items-start space-x-4';
                    newChapter.innerHTML = `
                        <div class="flex-grow">
                            <input type="text" placeholder="${translations[currentLang].chapterTitlePlaceholder}" value="AI Generated Chapter"
                                class="w-full px-4 py-2 border rounded-lg mb-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                            <textarea rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">${data.text}</textarea>
                        </div>
                        <button type="button" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    chaptersDiv.appendChild(newChapter);

                    // Add delete functionality to new chapter
                    const deleteButton = newChapter.querySelector('button');
                    deleteButton.addEventListener('click', () => {
                        newChapter.remove();
                    });

                    aiStatus.textContent = currentLang === 'fr' ? 'Contenu généré avec succès.' : 'Content generated successfully.';
                } else {
                    aiStatus.textContent = currentLang === 'fr' ? 'Erreur lors de la génération du contenu.' : 'Error generating content.';
                }
            } catch (error) {
                console.error('Error generating AI content:', error);
                aiStatus.textContent = currentLang === 'fr' ? 'Erreur lors de la génération du contenu.' : 'Error generating content.';
            }
        });

        // AI Illustration Generation Button Handler
        document.getElementById('generateIllustration').addEventListener('click', async () => {
            const prompt = document.getElementById('illustrationPrompt').value.trim();
            const illustrationPreview = document.getElementById('illustrationPreview');
            if (!prompt) {
                illustrationPreview.textContent = currentLang === 'fr' ? 'Veuillez saisir un prompt pour l\'illustration.' : 'Please enter a prompt for the illustration.';
                return;
            }
            illustrationPreview.textContent = currentLang === 'fr' ? 'Génération de l\'illustration en cours...' : 'Generating illustration...';

            try {
                const response = await fetch('http://localhost:3000/api/generate-image', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt }),
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                if (data.imageUrl) {
                    illustrationPreview.innerHTML = `<img src="${data.imageUrl}" alt="Illustration" class="max-w-full rounded shadow" />`;
                } else {
                    illustrationPreview.textContent = currentLang === 'fr' ? 'Erreur lors de la génération de l\'illustration.' : 'Error generating illustration.';
                }
            } catch (error) {
                console.error('Error generating AI illustration:', error);
                illustrationPreview.textContent = currentLang === 'fr' ? 'Erreur lors de la génération de l\'illustration.' : 'Error generating illustration.';
            }
        });
     </script>
 </body>
 </html>
